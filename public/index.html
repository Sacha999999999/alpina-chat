<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Alpina Conseil Chatbot</title>
</head>
<body>

<!-- INTERFACE CHAT COMPLÈTE -->
<div id="alp-chat-box" style="display:flex; flex-direction:column; width:330px; height:500px; ...styles...">
  <!-- EN-TETE -->
  <div style="...styles...">
    <span>ALPINA CONSEIL</span>
    <span onclick="window.close()" style="cursor:pointer;">✕</span>
  </div>

  <div id="alp-msgs" style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:8px; padding:10px;">
    <div style="background:#eee; padding:10px; border-radius:8px;">
      Bonjour, nous sommes à votre écoute. Comment pouvons-nous vous aider ?<br>
      <strong>Choisissez un sujet :</strong>
    </div>

    <div id="quick-buttons">
      <button data-value="Fiscalité">Fiscalité</button>
      <button data-value="Conseil financier et placements">Finances & Placements</button>
      <!-- ... autres boutons ... -->
    </div>
  </div>

  <div style="display:flex; padding:10px; border-top:1px solid #ccc;">
    <input type="text" id="alp-input" placeholder="Votre question..." style="flex:1;">
    <button id="send-btn">➤</button>
  </div>
</div>

<script>
document.querySelectorAll('#quick-buttons button').forEach(btn => {
  btn.onclick = () => {
    const input = document.getElementById('alp-input');
    input.value = btn.dataset.value;
    input.focus();
  };
});

async function sendMessage() {
  const input = document.getElementById('alp-input');
  const val = input.value.trim();
  if (!val) return;
  input.value = '';

  const m = document.getElementById('alp-msgs');

  // Message utilisateur
  const userMsg = document.createElement('div');
  userMsg.textContent = val;
  userMsg.style = "background:#002D58; color:white; padding:6px; border-radius:10px; align-self:flex-end;";
  m.appendChild(userMsg);

  // Loader
  const loader = document.createElement('div');
  loader.textContent = "Alpina IA analyse votre demande...";
  loader.style = "background:#f0f0f0; padding:10px; border-radius:12px;";
  loader.id = "alp-loading-indicator";
  m.appendChild(loader);

  // Fetch vers API Vercel
  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: val })
    });
    const data = await res.json();
    document.getElementById('alp-loading-indicator')?.remove();

    const aiMsg = document.createElement('div');
    aiMsg.textContent = data.text;
    aiMsg.style = "background:#fff; padding:10px; border-radius:12px; border-left:3px solid #D4AF37;";
    m.appendChild(aiMsg);
  } catch(e) {
    document.getElementById('alp-loading-indicator')?.remove();
    const errMsg = document.createElement('div');
    errMsg.textContent = "Erreur IA, réessayez plus tard.";
    errMsg.style = "background:#ffebee; color:#c62828; padding:8px; border-radius:8px;";
    m.appendChild(errMsg);
  }

  m.scrollTo({ top: m.scrollHeight, behavior: 'smooth' });
}

document.getElementById('send-btn').onclick = sendMessage;
document.getElementById('alp-input').onkeydown = e => { if(e.key==='Enter'){e.preventDefault(); sendMessage(); }};
</script>
</body>
</html>
