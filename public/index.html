<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Alpina Conseil Chatbot</title>
</head>
<body>

<!-- 1. LA STRUCTURE VISUELLE (HTML) -->
<div id="alp-chat-box" style="position:fixed; bottom:80px; right:20px; z-index:999999; display:none; width:330px; height:500px; background:#fff; border:2px solid #002D58; border-radius:10px; flex-direction:column; box-shadow:0 10px 30px rgba(0,0,0,0.3); font-family:Arial;">
  
  <!-- EN-TETE -->
  <div style="background:#002D58; color:#D4AF37; padding:15px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #D4AF37;">
    <div style="display:flex; flex-direction:column;">
      <span style="font-size:16px; letter-spacing:1px; line-height:1.2;">ALPINA CONSEIL</span>
      <span style="font-weight:100; color:#fff; font-size:11px; letter-spacing:0.5px; opacity:0.9;">Votre assistant numÃ©rique</span>
    </div>
    <span onclick="document.getElementById('alp-chat-box').style.display='none'" style="cursor:pointer; font-size:20px;">âœ•</span>
  </div>

  <div id="alp-msgs" style="flex:1; padding:10px; overflow-y:auto; background:#f9f9f9; font-size:14px; display:flex; flex-direction:column; gap:8px;">
    <div style="background:#eee; padding:10px; border-radius:8px; line-height:1.4; color:#333; font-size:12.5px;">
      Bonjour, nous sommes Ã  votre Ã©coute. Comment pouvons-nous vous aider ?<br>
      <strong>Choisissez un sujet ou <a href="https://www.alpina-conseil.ch/contact" target="_blank" style="color:#002D58; text-decoration:underline;">fixez un rendez-vous</a> :</strong>
    </div>

    <div id="quick-buttons" style="display:flex; flex-wrap:wrap; gap:5px; margin-top:5px;">
      <button data-value="FiscalitÃ©" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">FiscalitÃ©</button>
      <button data-value="Conseil financier et placements" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Finances & Placements</button>
      <button data-value="3Ã¨me pilier" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">3Ã¨me pilier</button>
      <button data-value="HypothÃ¨que" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">HypothÃ¨que</button>
      <button data-value="Planification successorale" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Succession</button>
      <button data-value="PrÃ©voyance et retraite" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">PrÃ©voyance & Retraite</button>
      <button data-value="Gestion de fortune" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Gestion de fortune</button>
      <button data-value="Conseil immobilier" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Immobilier</button>
    </div>
  </div>

  <div style="display:flex; padding:10px; border-top:1px solid #ccc;">
    <input type="text" id="alp-input" placeholder="Votre question..." style="flex:1; border:none; outline:none; font-size:14px; color:#333;">
    <button id="send-btn" style="background:#002D58; color:#D4AF37; border:none; padding:0 15px; cursor:pointer; font-size:18px;">âž¤</button>
  </div>
</div>

<!-- BOUTON FLOTTANT -->
<button id="alp-toggle" style="position:fixed; bottom:15px; right:20px; z-index:999999; background:#002D58; color:#D4AF37; border:2px solid #D4AF37; border-radius:50%; width:60px; height:60px; cursor:pointer; font-size:24px; box-shadow:0 4px 15px rgba(0,0,0,0.4);">
ðŸ’¬
</button>

<!-- 2. LE MOTEUR (JAVASCRIPT) -->
<script>
document.getElementById('alp-toggle').onclick = function() {
  const s = document.getElementById('alp-chat-box').style;
  s.display = (s.display === 'flex' ? 'none' : 'flex');
};

document.querySelectorAll('#quick-buttons button').forEach(btn => {
  btn.onclick = function() {
    const input = document.getElementById('alp-input');
    input.value = this.dataset.value;
    input.focus();
  };
});

// âœ… Fonction principale pour envoyer la question et ouvrir le chat externe
async function sendMessage() {
  const input = document.getElementById('alp-input');
  const m = document.getElementById('alp-msgs');
  const val = input.value.trim();
  if (!val) return;
  input.value = '';

  // Affiche le message utilisateur dans la bulle locale
  const userMsg = document.createElement('div');
  userMsg.style = "background:#002D58; color:white; padding:6px 10px; border-radius:10px 10px 0 10px; align-self:flex-end; max-width:85%; margin-bottom:5px; font-size:13px;";
  userMsg.textContent = val;
  m.appendChild(userMsg);

  // Loader
  const loader = document.createElement('div');
  loader.id = "alp-loading-indicator";
  loader.style = "background:#f0f0f0; padding:10px; border-radius:12px 12px 12px 0; align-self:flex-start; font-style:italic; color:#666; font-size:12px; border-left:3px solid #D4AF37; margin-bottom:5px;";
  loader.textContent = "Alpina IA analyse votre demande...";
  m.appendChild(loader);

  // Ouvre une nouvelle fenÃªtre externe pour le chat complet (Vercel)
  window.open(`https://alpina-chat.vercel.app/?question=${encodeURIComponent(val)}`, 'AlpinaBot', 'width=360,height=520,resizable=yes,scrollbars=yes');

  document.getElementById('alp-loading-indicator')?.remove();
  m.scrollTo({ top: m.scrollHeight, behavior: 'smooth' });
}

document.getElementById('send-btn').onclick = sendMessage;
document.getElementById('alp-input').onkeydown = function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
};
</script>

</body>
</html>
