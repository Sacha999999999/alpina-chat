<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Alpina Conseil</title>
</head>
<body style="margin:0; padding:0; background:#f4f4f4;">

<!-- 1. LA STRUCTURE VISUELLE (HTML) -->
<div id="alp-chat-box" style="position:fixed; bottom:80px; right:20px; z-index:999999; display:none; width:330px; height:500px; background:#fff; border:2px solid #002D58; border-radius:10px; flex-direction:column; box-shadow:0 10px 30px rgba(0,0,0,0.3); font-family:Arial;">
  
  <!-- EN-TETE -->
  <div style="background:#002D58; color:#D4AF37; padding:15px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; border-bottom: 2px solid #D4AF37;">
    <div style="display:flex; flex-direction:column;">
      <span style="font-size:16px; letter-spacing:1px; line-height:1.2;">ALPINA CONSEIL</span>
      <span style="font-weight:100; color:#fff; font-size:11px; letter-spacing:0.5px; opacity:0.9;">Votre assistant num√©rique</span>
    </div>
    <span onclick="document.getElementById('alp-chat-box').style.display='none'" style="cursor:pointer; font-size:20px;">‚úï</span>
  </div>

  <div id="alp-msgs" style="flex:1; padding:10px; overflow-y:auto; background:#f9f9f9; font-size:14px; display:flex; flex-direction:column; gap:8px;">
    <div style="background:#eee; padding:10px; border-radius:8px; line-height:1.4; color:#333; font-size:12.5px;">
      Bonjour, nous sommes √† votre √©coute. Comment pouvons-nous vous aider ?<br>
      <strong>Choisissez un sujet ou <a href="https://www.alpina-conseil.ch/contact" target="_blank" style="color:#002D58; text-decoration:underline;">fixez un rendez-vous</a> :</strong>
    </div>

    <!-- LES SUJETS -->
    <div id="quick-buttons" style="display:flex; flex-wrap:wrap; gap:5px; margin-top:5px;">
      <button data-value="Fiscalit√©" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Fiscalit√©</button>
      <button data-value="Conseil financier et placements" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Finances & Placements</button>
      <button data-value="3√®me pilier" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">3√®me pilier</button>
      <button data-value="Hypoth√®que" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Hypoth√®que</button>
      <button data-value="Planification successorale" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Succession</button>
      <button data-value="Pr√©voyance et retraite" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Pr√©voyance & Retraite</button>
      <button data-value="Gestion de fortune" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Gestion de fortune</button>
      <button data-value="Conseil immobilier" style="background:#fff; border:1px solid #002D58; color:#002D58; border-radius:15px; padding:5px 10px; font-size:11px; cursor:pointer;">Immobilier</button>
    </div>
  </div>

  <div style="display:flex; padding:10px; border-top:1px solid #ccc;">
    <input type="text" id="alp-input" placeholder="Votre question..." style="flex:1; border:none; outline:none; font-size:14px; color:#333;">
    <button id="send-btn" style="background:#002D58; color:#D4AF37; border:none; padding:0 15px; cursor:pointer; font-size:18px;">‚û§</button>
  </div>
</div>

<button id="alp-toggle" style="position:fixed; bottom:15px; right:20px; z-index:999999; background:#002D58; color:#D4AF37; border:2px solid #D4AF37; border-radius:50%; width:60px; height:60px; cursor:pointer; font-size:24px; box-shadow:0 4px 15px rgba(0,0,0,0.4);">
üí¨
</button>

<!-- 2. LE MOTEUR (JAVASCRIPT) -->
<script>
document.getElementById('alp-toggle').onclick = function() {
  const s = document.getElementById('alp-chat-box').style;
  s.display = (s.display === 'flex' ? 'none' : 'flex');
};

document.querySelectorAll('#quick-buttons button').forEach(btn => {
  btn.onclick = function() {
    const input = document.getElementById('alp-input');
    input.value = this.dataset.value;
    input.focus();
  };
});

async function sendMessage() {
  const input = document.getElementById('alp-input');
  const m = document.getElementById('alp-msgs');
  const val = input.value.trim();
  if (!val) return;
  input.value = '';

  const userMsg = document.createElement('div');
  userMsg.style = "background:#002D58; color:white; padding:6px 10px; border-radius:10px 10px 0 10px; align-self:flex-end; max-width:85%; margin-bottom:5px; font-size:13px;";
  userMsg.textContent = val;
  m.appendChild(userMsg);

  const loader = document.createElement('div');
  loader.id = "alp-loading-indicator";
  loader.style = "background:#f0f0f0; padding:10px; border-radius:12px 12px 12px 0; align-self:flex-start; font-style:italic; color:#666; font-size:12px; border-left:3px solid #D4AF37; margin-bottom:5px;";
  loader.textContent = "Alpina IA analyse votre demande...";
  m.appendChild(loader);
  m.scrollTop = m.scrollHeight;

  try {
    // CORRECTION ICI : Lien complet vers l'API Vercel
    const response = await fetch("https://alpina-chat.vercel.app", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: val })
    });
    const data = await response.json();
    document.getElementById('alp-loading-indicator')?.remove();

    const aiMsg = document.createElement('div');
    aiMsg.style = "background:#fff; padding:10px; border-radius:12px 12px 12px 0; align-self:flex-start; border-left:3px solid #D4AF37; max-width:80%; box-shadow:0 2px 5px rgba(0,0,0,0.05); margin-bottom:5px; line-height:1.4; color:#333;";
    aiMsg.textContent = data.text;
    m.appendChild(aiMsg);
  } catch (err) {
    document.getElementById('alp-loading-indicator')?.remove();
    const errMsg = document.createElement('div');
    errMsg.style = "background:#ffebee; color:#c62828; padding:8px; border-radius:8px; font-size:12px;";
    errMsg.textContent = "Erreur de connexion.";
    m.appendChild(errMsg);
  }
  m.scrollTo({ top: m.scrollHeight, behavior: 'smooth' });
}

document.getElementById('send-btn').onclick = sendMessage;
document.getElementById('alp-input').onkeydown = function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
};
</script>
</body>
</html>
